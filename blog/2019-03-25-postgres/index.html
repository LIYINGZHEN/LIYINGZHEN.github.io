<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="     &#34;Max&#34;">
<meta name="description"
    content="Setting up a password for the postgres role By default, local connections to PostgreSQL use the peer authentication sys- tem. That means that instead of asking for a password, they check to see if we are currently logged into a user (a linux user) that matches a user name in Postgres. We are going to change the way we do authentication and instead tell Postgres to use an encrypted password, but first we need to actually set a password for the postgres user." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://liyingzhen.github.io/blog/2019-03-25-postgres/" />


<title>
    
    PostgreSQL :: YING ZHEN LI 
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://liyingzhen.github.io/main.min.6a7678f40434c7781747ffdd224a984179b2a3c81c81f19ccf845fdffbe80b7c.css">



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627">
<meta itemprop="name" content="PostgreSQL">
<meta itemprop="description" content=" ">


<meta itemprop="datePublished" content="2019-03-25T18:02:49&#43;01:00" />
<meta itemprop="dateModified" content="2019-03-25T18:02:49&#43;01:00" />
<meta itemprop="wordCount" content="468">



<meta itemprop="keywords" content="postgres," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://liyingzhen.github.io/"/>

<meta name="twitter:title" content="PostgreSQL"/>
<meta name="twitter:description" content=" "/>



<meta property="article:section" content="notes" />

<meta property="article:published_time" content="2019-03-25 18:02:49 &#43;0100 CET" />







    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">cd $HOME</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://liyingzhen.github.io/about">About</a></li><li><a href="https://liyingzhen.github.io/blog">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://liyingzhen.github.io/blog/2019-03-25-postgres/">PostgreSQL</a></h2>

            

            <div class="post-content">
                

<h2 id="setting-up-a-password-for-the-postgres-role">Setting up a password for the postgres role</h2>

<p>By default, local connections to PostgreSQL use the peer authentication sys- tem. That means that instead of asking for a password, they check to see if we are currently logged into a user (a linux user) that matches a user name in Postgres.
We are going to change the way we do authentication and instead tell Postgres to use an encrypted password, but first we need to actually set a password for the postgres user. To do this we need to open up psql as the user postgres.</p>

<pre><code class="language-bash">$ sudo -u postgres psql
</code></pre>

<p>We should see output that looks something like this:</p>

<pre><code class="language-bash">could not change directory to &quot;/root&quot;: Permission denied
psql (9.5.4)
Type &quot;help&quot; for help.
postgres=#
</code></pre>

<p>Don’t worry about the permission denied error. This isn’t important right now. What is important is that we are now connected to Postgres and we want to change the password for the user postgres. To do this, we run the following SQL code.</p>

<pre><code class="language-bash">ALTER USER postgres WITH ENCRYPTED PASSWORD 'xxxxxxx';
</code></pre>

<p>Note: Be sure to replace the xxxxxxx with an actual password.
What we are doing here is telling Postgres that we want to update the user postgres by setting an encrypted password of xxxxxxx. If we did this correctly we will get the following output:</p>

<pre><code class="language-bash">ALTER ROLE
postgres=#
</code></pre>

<p>That is all we need to do inside of Postgres. Go ahead and quit by pressing ctrl-d.</p>

<p>Now that we have a password set for the postgres user we want to update Post- gres to use this password. To do this we need to edit the pg_hba.conf file.</p>

<pre><code class="language-bash">sudo nano /etc/postgresql/10/main/pg_hba.conf
</code></pre>

<p>Look for an uncommented line (a line that doesn’t start with #) that has the contents shown below. The spacing will be slightly different, but the words should be the same.</p>

<pre><code class="language-bash">local   all   postgres   md5
</code></pre>

<p>The last part of this line is what we want to change. This is what determines how we authenticate the postgres user when making a local connection. Instead of peer, which uses your system user name to authenticate you, we want to use md5 which uses an encrypted password for authentication. Replace the word peer with md5.</p>

<pre><code class="language-bash">local   all   postgres   md5
</code></pre>

<p>Press ctrl+x (even on Mac) to close nano, then hit y to confirm that you want to save, and hit enter to confirm the same file name as the original.
Now we need to restart Postgres so the changes take effect.</p>

<pre><code class="language-bash">sudo service postgresql restart
</code></pre>

<p>Now if we want to connect to PostgreSQL we can using the postgres user and a password.</p>

<pre><code class="language-bash">psql -U postgres
</code></pre>

<p>Note: When prompted for your password, type it in.</p>

<p>Once we have logged into postgres using a password, the final step we need to take is creating our production database.</p>

<pre><code class="language-bash">CREATE DATABASE lenslocked_prod;
</code></pre>

            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://liyingzhen.github.io/tags/postgres">postgres</a></span>
  				</p>
  			</div>

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2018 - 2019</span>
            
                <span>Max Li</span>
            
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://liyingzhen.github.io/bundle.min.cf7871ed49474a80ed457154d24e61f7881adbe0f9384951a74ac46b688a39a4dbfa68bc6d37baeb058186de354ead3487d4ee7f083ea4cba860c48600b694f3.js" integrity="sha512-z3hx7UlHSoDtRXFU0k5h94ga2&#43;D5OElRp0rEa2iKOaTb&#43;mi8bTe66wWBht41Tq00h9Tufwg&#43;pMuoYMSGALaU8w=="></script>



    </body>
</html>
