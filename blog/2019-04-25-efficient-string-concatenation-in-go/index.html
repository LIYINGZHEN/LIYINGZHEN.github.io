<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
    content="     &#34;Max&#34;">
<meta name="description"
    content="In this article I investigate the computational performance of various string concatenation methods in the Go programming language.
To evaluate the options, I prepared some typical Go benchmarks using the Go testing package. A benchmark looks something like this:
func BenchmarkNative(b *testing.B) { var s string next := nextString() for i := 0; i &amp;lt; b.N; i&#43;&#43; { s &#43;= next() } }  For the purposes of these benchmarks, I imagined having a process that returns string segments one by one, and these segments need to be concatenated to form one string." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://www.maxlivinci.com/blog/2019-04-25-efficient-string-concatenation-in-go/" />


<title>
    
    Efficient String Concatenation in Go :: MAX LI 
    
</title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="https://www.maxlivinci.com/main.min.6a7678f40434c7781747ffdd224a984179b2a3c81c81f19ccf845fdffbe80b7c.css">



<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#252627">
<link rel="shortcut icon" href="/favicon.ico">
<meta name="theme-color" content="#252627">
<meta itemprop="name" content="Efficient String Concatenation in Go">
<meta itemprop="description" content="In this article I investigate the computational performance of various string concatenation methods in the Go programming language.
To evaluate the options, I prepared some typical Go benchmarks using the Go testing package. A benchmark looks something like this:
func BenchmarkNative(b *testing.B) { var s string next := nextString() for i := 0; i &lt; b.N; i&#43;&#43; { s &#43;= next() } }  For the purposes of these benchmarks, I imagined having a process that returns string segments one by one, and these segments need to be concatenated to form one string.">


<meta itemprop="datePublished" content="2019-04-25T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-04-25T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="380">



<meta itemprop="keywords" content="go," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.maxlivinci.com"/>

<meta name="twitter:title" content="Efficient String Concatenation in Go"/>
<meta name="twitter:description" content="In this article I investigate the computational performance of various string concatenation methods in the Go programming language.
To evaluate the options, I prepared some typical Go benchmarks using the Go testing package. A benchmark looks something like this:
func BenchmarkNative(b *testing.B) { var s string next := nextString() for i := 0; i &lt; b.N; i&#43;&#43; { s &#43;= next() } }  For the purposes of these benchmarks, I imagined having a process that returns string segments one by one, and these segments need to be concatenated to form one string."/>




<meta property="article:published_time" content="2019-04-25 00:00:00 &#43;0000 &#43;0000" />







    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">cd $HOME</span>
            <span class="logo__cursor"></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://www.maxlivinci.com/about">About</a></li><li><a href="https://www.maxlivinci.com/blog">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>2 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title"><a href="https://www.maxlivinci.com/blog/2019-04-25-efficient-string-concatenation-in-go/">Efficient String Concatenation in Go</a></h1>

            

            <div class="post-content">
                

<p>In this article I investigate the computational performance of various string concatenation methods in the Go programming language.</p>

<p>To evaluate the options, I prepared some typical Go benchmarks using the Go testing package. A benchmark looks something like this:</p>

<pre><code class="language-go">func BenchmarkNative(b *testing.B) {
	var s string
	next := nextString()
	for i := 0; i &lt; b.N; i++ {
		s += next()
	}
}
</code></pre>

<p>For the purposes of these benchmarks, I imagined having a process that returns string segments one by one, and these segments need to be concatenated to form one string. To represent such a process, I created a simple iterator that returns the string version of its current index on each call:</p>

<pre><code class="language-go">// nextString is an iterator we use to represent a process
// that returns strings that we want to concatenate in order.
func nextString() func() string {
    n := 0
    // closure captures variable n
    return func() string {
        n += 1
        return strconv.Itoa(n)
    }
}
</code></pre>

<p>Every method we evaluate will call this function in a loop so that the fully concatenated string looks something like <code>0123456789101112131415....</code> There is function call overhead to take into account in this, but since all the benchmarks will have the same overhead, the comparison is still fair. Now that we have the basic setup for the benchmark, let’s see what the methods are we’ll be evaluating.</p>

<h2 id="method-1-naive-appending-with">Method 1: Naive Appending with +=</h2>

<pre><code class="language-go">func BenchmarkNaiveConcat(b *testing.B) {
	var s string
	next := nextString()
	for i := 0; i &lt; b.N; i++ {
		s += next()
	}
}
</code></pre>

<h2 id="method-2-strings-join">Method 2: strings.Join</h2>

<pre><code class="language-go">func BenchmarkJoin(b *testing.B) {
	var s string
	next := nextString()
	for i := 0; i &lt; b.N; i++ {
		s = strings.Join([]string{s, next()}, &quot;&quot;)
	}
}
</code></pre>

<h2 id="method-3-sprintf">Method 3: Sprintf</h2>

<pre><code class="language-go">func BenchmarkSprintf(b *testing.B) {
	var s string
	next := nextString()
	for i := 0; i &lt; b.N; i++ {
		s = fmt.Sprintf(&quot;%s%s&quot;, s, next())
	}
}
</code></pre>

<h2 id="method-4-bytes-buffer">Method 4: bytes.Buffer</h2>

<pre><code class="language-go">func BenchmarkBufferString(b *testing.B) {
	buffer := bytes.NewBufferString(&quot;&quot;)
	next := nextString()
	for i := 0; i &lt; b.N; i++ {
		buffer.WriteString(next())
	}
	buffer.String()
}
</code></pre>

<h2 id="the-result">The result</h2>

<p><code>Method #4 (bytes.Buffer)</code> is the winner!</p>

<pre><code class="language-go">BenchmarkNaiveConcat    	  300000	    166993 ns/op	    809751 B/op	    2 allocs/op
BenchmarkJoin           	  200000	    150370 ns/op	    518121 B/op	    2 allocs/op
BenchmarkSprintf        	  100000	    104652 ns/op	    481905 B/op	    5 allocs/op
BenchmarkBufferString   	20000000	      89.0 ns/op	        44 B/op     0 allocs/op
</code></pre>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://www.maxlivinci.com/tags/go">go</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>380 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2019-04-25 08:00 &#43;0800</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h">Read other posts</span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://www.maxlivinci.com/blog/2019-04-26-json-and-go/">
                                <span class="button__icon">←</span>
                                <span class="button__text">JSON and Go</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://www.maxlivinci.com/blog/2019-04-24-writing-middleware-in-golang/">
                                <span class="button__text">Writing middleware in Golang</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2018 - 2019</span>
            
                <span>Max Li</span>
            
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">

        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="https://www.maxlivinci.com/bundle.min.cf7871ed49474a80ed457154d24e61f7881adbe0f9384951a74ac46b688a39a4dbfa68bc6d37baeb058186de354ead3487d4ee7f083ea4cba860c48600b694f3.js" integrity="sha512-z3hx7UlHSoDtRXFU0k5h94ga2&#43;D5OElRp0rEa2iKOaTb&#43;mi8bTe66wWBht41Tq00h9Tufwg&#43;pMuoYMSGALaU8w=="></script>



    </body>
</html>
