---
title:       "PostgreSQL"
description: " "
date:        2019-03-25T18:02:49+01:00
author:      "Max"
published:   true
tags:        ["postgres"]
categories:  ["notes"]
---

## Setting up a password for the postgres role

By default, local connections to PostgreSQL use the peer authentication sys- tem. That means that instead of asking for a password, they check to see if we are currently logged into a user (a linux user) that matches a user name in Postgres.
We are going to change the way we do authentication and instead tell Postgres to use an encrypted password, but first we need to actually set a password for the postgres user. To do this we need to open up psql as the user postgres.

```bash
$ sudo -u postgres psql
```

We should see output that looks something like this:

```bash
could not change directory to "/root": Permission denied
psql (9.5.4)
Type "help" for help.
postgres=#
```

Don’t worry about the permission denied error. This isn’t important right now. What is important is that we are now connected to Postgres and we want to change the password for the user postgres. To do this, we run the following SQL code.

```bash
ALTER USER postgres WITH ENCRYPTED PASSWORD 'xxxxxxx';
```

Note: Be sure to replace the xxxxxxx with an actual password.
What we are doing here is telling Postgres that we want to update the user postgres by setting an encrypted password of xxxxxxx. If we did this correctly we will get the following output:

```bash
ALTER ROLE
postgres=#
```

That is all we need to do inside of Postgres. Go ahead and quit by pressing ctrl-d.

Now that we have a password set for the postgres user we want to update Post- gres to use this password. To do this we need to edit the pg_hba.conf file.

```bash
sudo nano /etc/postgresql/10/main/pg_hba.conf
```

Look for an uncommented line (a line that doesn’t start with #) that has the contents shown below. The spacing will be slightly different, but the words should be the same.

```bash
local   all   postgres   md5
```

The last part of this line is what we want to change. This is what determines how we authenticate the postgres user when making a local connection. Instead of peer, which uses your system user name to authenticate you, we want to use md5 which uses an encrypted password for authentication. Replace the word peer with md5.

```bash
local   all   postgres   md5
```

Press ctrl+x (even on Mac) to close nano, then hit y to confirm that you want to save, and hit enter to confirm the same file name as the original.
Now we need to restart Postgres so the changes take effect.

```bash
sudo service postgresql restart
```

Now if we want to connect to PostgreSQL we can using the postgres user and a password.

```bash
psql -U postgres
```

Note: When prompted for your password, type it in.

Once we have logged into postgres using a password, the final step we need to take is creating our production database.

```bash
CREATE DATABASE lenslocked_prod;
```

