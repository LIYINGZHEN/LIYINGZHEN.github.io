---
title:       "Docker"
description: " "
date:        2019-03-08T13:00:00+00:00
author:      "Max"
published:   true
tags:        ["docker"]
categories:  ["notes"]
---

# Terminology

**Image** - Images are the building blocks of the Docker world. You launch your containers from images.

**Container** - Docker helps you build and deploy containers inside of which you can package your applications and services.

**Docker Compose** - Allows you to run stacks of containers to represent application stacks.

# Commands

```bash
# Checking that the docker binary works.
docker info

# Build a docker image.
docker build
  -t <image-name>:<tag> # name docker image
  --no-cache            # do not use cache
  .

#
docker run
  -v <source>:<destination> # create a volume in our container from a directory on the host
  -i                        # keeps STDIN open
  -t                        # asllocates a pseudo terminal (TTY)
  --name <container-name>   # name the container
  -e NAME=Sam               # environment variable
  -p 5432:5432              # ports
  -d                        # run in the background
  --rm                      #
  --restart=always          #
  <image>:<tag>

# Getting additional information about a container.
docker inspect
  -f '{{ .NetworkSettings.IPAddress }}'   # selectively query.
  <container-name>

# Listing Docker images
docker images

# Running a shell inside an existing container.
docker exec
  -i               # Makes sure STDIN is kept open.
  -t               # Asllocates a pseudo terminal (TTY).
  <container-name>
  sh | bash

# Remove an old image.
docker rmi <image-name>
# Remove old images.
docker rmi -f 'docker images -q -f dangling=true'
# Deleting all images
sudo docker rmi `docker images -a -q`

# Stop a container.
docker stop <container-name>
# Stop all containers.
docker stop $(docker ps -a -q)

# Remove a container.
docker remove <container-name>
# Remove all containers.
docker rm $(docker ps -a -q)

# Remove unused data.
docker system prune -a -f

# Listing running containers.
docker ps
  -a      # include stopped
  -q      # only returns the container IDs

# Starting a stopped container.
docker start <continaer-name>

# Restarting a stopped container.
docker restart <continaer-name>

#
docker logs
  -f               # tail
  -t               # timestamps
  <continaer-name>

#
docker commit id

# Stopping the running Docker container.
docker stop <continaer-name>

# Tagging an image under an additional tag.
docker tag <image-name> <docker-hub-id>/<image-name>:<version>

# Pulling a image
docker pull <docker-hub-id>/<image-name>:<version>

# Pushing the image to docker hub.
docker push <docker-hub-id>/<image-name>:<version>

#
docker-machine ls

# Attach local standard input, output, and error streams to a running container.
docker attach <continaer-name>

# Shows statistics for a container
docker stats <continaer-name>

# Searching for images
docker search puppet

# Inspecting the container’s processes
docker top
```

# YAML

Dockerfile.yaml

```yaml
# The base image you’re building on top of.
FROM

MAINTAINER Max Li "maxlivinci@gmail.com"

# The ENV instruction is used to set environment variables during the image build process.
ENV KEY VALUE

RUN

# The WORKDIR instruction provides a way to set the working directory for the container and
# the ENTRYPOINT and/or CMD to be executed when a container is launched from the image.
WORKDIR

# Use COPY unless you sure you need ADD
# The key difference is that the COPY instruction is purely focused on copying local files from the build context and does not have any extraction or decompression capabilities.
COPY


ADD

#
VOLUME ["/opt/project"]

#
LABEL key="value"

# The ARG instruction defines variables that can be passed at build-time via the docker build command.
ARG webapp_user=user

EXPOSE 80

# Any arguments we specify on the docker run command line will
# be passed as arguments to the command specified in the ENTRYPOINT.
ENTRYPOINT ["/usr/sbin/nginx"]
# The CMD instruction specifies the command to run when a container is launched.
# We can override the CMD instruction on the docker run command line.
CMD ["-h"]
```
