---
title:       "Docker"
description: " "
date:        2019-03-08T13:00:00+00:00
author:      "Max"
published:   true
tags:        ["docker"]
categories:  ["notes"]
---

# Docker

## Terminology

**Image** - Images are the building blocks of the Docker world. You launch your containers from images.

**Container** - Docker helps you build and deploy containers inside of which you can package your applications and services.

**Docker Compose** - Allows you to run stacks of containers to represent application stacks.

## Commands

```bash
# Checking that the docker binary works.
docker info

# Build a docker image.
docker build
  -t <image-name>:<tag> # name docker image
  --no-cache            # do not use cache
  .

#
docker run
  -v <source>:<destination> # create a volume in our container from a directory on the host
  --net=<NETWORK>           # Creating a container inside a Docker network
  --volumes-from            # 
  -i                        # keeps STDIN open
  -t                        # asllocates a pseudo terminal (TTY)
  --name <CONTAINER>        # name the container
  -e NAME=Sam               # environment variable
  -p 5432:5432              # ports
  -d                        # run in the background
  --rm                      #
  --restart=always          #
  <image>:<tag>

# Getting additional information about a container.
docker inspect
  -f '{{ .NetworkSettings.IPAddress }}'   # selectively query.
  <CONTAINER>

# Listing Docker images
docker images

# Running a shell inside an existing container.
docker exec
  -i               # Makes sure STDIN is kept open.
  -t               # Asllocates a pseudo terminal (TTY).
  <CONTAINER>
  sh | bash

# Remove an old image.
docker rmi <image-name>
# Remove old images.
docker rmi -f 'docker images -q -f dangling=true'
# Deleting all images
sudo docker rmi `docker images -a -q`

# Stop a container.
docker stop <CONTAINER>
# Stop all containers.
docker stop $(docker ps -a -q)

# Remove a container.
docker remove <CONTAINER>
# Remove all containers.
docker rm $(docker ps -a -q)

# Remove unused data.
docker system prune -a -f

# Listing running containers.
docker ps
  -a      # include stopped
  -q      # only returns the container IDs

# Starting a stopped container.
docker start <CONTAINER>

# Restarting a stopped container.
docker restart <CONTAINER>

#
docker logs
  -f               # tail
  -t               # timestamps
  <CONTAINER>

#
docker commit id

# Stopping the running Docker container.
docker stop <CONTAINER>

# Tagging an image under an additional tag.
docker tag <image-name> <docker-hub-id>/<image-name>:<version>

#
docker-machine ls

# Attach local standard input, output, and error streams to a running container.
docker attach <CONTAINER>

# Shows statistics for a container
docker stats <CONTAINER>

# Searching for images
docker search puppet

# Inspecting the container’s processes
docker top

# List port mappings or a specific mapping for the container.
docker port <CONTAINER>

# Show the history of an image
docker history

# Display the running processes of a container
docker top <CONTAINER>
```

### Volumes

```bash
# Remove unused volumes using docker volume prune.
docker volume prune
```

### Network

```bash
# Creating a Docker network.
docker network create <NETWORK>

# Inspecting network.
docker network inspect <NETWORK>

# List all current networks.
sudo docker network ls

# Adding a new container to the network.
docker network connect <NETWORK> <CONTAINER>

# Disconnecting a host from a network.
docker network disconnect <NETWORK> <CONTAINER>
```

### DockerHub

```bash
# Pulling a image
docker pull <docker-hub-id>/<image-name>:<version>

# Pushing the image to docker hub.
docker push <docker-hub-id>/<image-name>:<version>
```

## The Dockerfile.yaml file

```yaml
# The base image you’re building on top of.
FROM

# The ENV instruction is used to set environment variables during the image build process.
ENV KEY VALUE

RUN

# The WORKDIR instruction provides a way to set the working directory for the container and
# the ENTRYPOINT and/or CMD to be executed when a container is launched from the image.
WORKDIR

# Use COPY unless you sure you need ADD
# The key difference is that the COPY instruction is purely focused on copying local files from the build context and does not have any extraction or decompression capabilities.
COPY

ADD

#
VOLUME ["/opt/project"]

#
LABEL key="value"

# The ARG instruction defines variables that can be passed at build-time via the docker build command.
ARG webapp_user=user

EXPOSE 80

# Any arguments we specify on the docker run command line will
# be passed as arguments to the command specified in the ENTRYPOINT.
ENTRYPOINT ["/usr/sbin/nginx"]
# The CMD instruction specifies the command to run when a container is launched.
# We can override the CMD instruction on the docker run command line.
CMD ["-h"]
```

## Docker Volume

Writing into a container’s writable layer requires a storage driver to manage the filesystem. The storage driver provides a union filesystem, using the Linux kernel. This extra abstraction reduces performance as compared to using data volumes, which write directly to the host filesystem.










# Docker Compose

## The docker-compose.yml file

```yaml
version: '3'
  services:
    web:
      image: jamtur01/composeapp
      command: python app.py
      ports:
      - "5000:5000"
      volumes:
      - .:/composeapp
    redis:
      image: redis
```

## Commands

```bash
# Lists all of the currently running services.
docker-compose ps
# Show log events.
docker-compose logs
# Stop running services.
docker-compose stop
# Force kill the services.
docker- compose kill
# Restart services.
docker-compose start
# Remove services.
docker-compose rm
```
